<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oleeh Live Command</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #f5f5f7; --card: #ffffff; --text: #1d1d1f; --input-bg: #ffffff; --border: #d2d2d7; --primary: #00d1b2; --error: #d70015; --warning: #ff9500; }
        [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --input-bg: #121212; --border: #333; }

        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; transition: background 0.3s; }
        .container { width: 100%; max-width: 500px; position: relative; }
        
        .controls { position: absolute; top: 0; right: 0; display: flex; gap: 8px; z-index: 1001; }
        .icon-btn { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; }
        
        h1 { text-align: center; color: var(--primary); cursor: pointer; margin-top: 50px; margin-bottom: 20px; }
        
        .search-container { position: sticky; top: 10px; z-index: 1000; margin-bottom: 20px; width: 100%; }
        .search-input { width: 100%; padding: 12px 20px; border-radius: 25px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-size: 1.1rem; outline: none; box-sizing: border-box; text-align: right; direction: rtl; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

        #adminPanel { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 30px; display: none; border: 1px dashed var(--primary); }
        textarea { width: 100%; height: 100px; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); font-size: 1.1rem; resize: none; box-sizing: border-box; text-align: right; direction: rtl; }
        
        .post { background: var(--card); padding: 25px 20px 20px 20px; border-radius: 12px; margin-bottom: 20px; position: relative; border-left: 6px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .post.is-mistake { border-left-color: var(--error); background: #fff8f8; }
        [data-theme="dark"] .post.is-mistake { background: #2a1a1a; }
        .post.is-delay { border-left-color: var(--warning); }
        
        /* ‚õîÔ∏è Badge Styling */
        .badge { display: inline-flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 6px; font-size: 0.8rem; font-weight: 900; margin-bottom: 12px; direction: ltr; }
        .badge-mistake { background: var(--error); color: white; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 2px 10px rgba(215,0,21,0.2); }
        .badge-delay { background: var(--warning); color: #000; }

        .post p { margin: 5px 0 15px 0; line-height: 1.6; font-size: 1.1rem; white-space: pre-wrap; text-align: right; direction: rtl; }
        .btn-link { color: var(--primary); text-decoration: none; font-weight: bold; border: 1px solid var(--primary); padding: 6px 18px; border-radius: 5px; }
        
        .meta { font-size: 0.75rem; color: #888; border-top: 1px solid var(--border); padding-top: 12px; margin-top: 10px; display: flex; justify-content: space-between; }
        
        .admin-tools { position: absolute; top: -14px; right: 10px; display: none; gap: 10px; background: var(--bg); padding: 6px 12px; border-radius: 12px; border: 1px solid var(--border); z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .admin-active .admin-tools { display: flex; }
        .tool-btn { cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .tool-txt { cursor: pointer; font-size: 0.75rem; font-weight: bold; margin-left: 5px; padding: 2px 6px; border-radius: 4px; border: 1px solid var(--border); }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <div class="controls">
        <button class="icon-btn" id="notifBtn" onclick="requestNotifPermission()"><span id="notifIcon">üîî</span></button>
        <button class="icon-btn" onclick="toggleTheme()"><span id="themeIcon">üåô</span></button>
        <button class="icon-btn" id="muteBtn" onclick="toggleMute()"><span id="muteIcon">üîä</span></button>
    </div>

    <h1 onclick="toggleAdmin()">üì° Oleeh Feed</h1>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search news..." onkeyup="filterPosts()">
    </div>

    <div id="adminPanel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong>Broadcast Center</strong>
            <span id="cancelBtn" onclick="cancelEdit()" style="color:var(--error); cursor:pointer; font-size:0.8rem; display:none;">Cancel</span>
        </div>
        <textarea id="msgInput" placeholder="Enter message..." onkeydown="handleEnter(event)"></textarea>
        <button id="submitBtn" style="width:100%; padding:14px; background:var(--primary); border:none; border-radius:8px; font-weight:bold; color:white; cursor:pointer;" onclick="sendPost()">Broadcast</button>
    </div>

    <div id="feed">Connecting...</div>
</div>

<audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" preload="auto"></audio>

<script>
    const firebaseConfig = { databaseURL: "https://oleehfeed-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('live_posts');

    let firstLoad = true;
    let isMuted = false;

    function requestNotifPermission() {
        if (!("Notification" in window)) return;
        Notification.requestPermission().then(updateNotifIcon);
    }

    function updateNotifIcon() {
        const icon = document.getElementById('notifIcon');
        icon.innerText = (Notification.permission === "granted") ? "üîî" : (Notification.permission === "denied" ? "üîï" : "üîî");
    }

    function notifyTeam(msg) {
        if (!isMuted && Notification.permission === "granted" && document.hidden) {
            new Notification("Oleeh Update", { body: msg });
        }
    }

    function handleEnter(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendPost(); } }

    function sendPost() {
        const msg = document.getElementById('msgInput').value;
        const editingId = document.getElementById('editingId').value;
        if(!msg.trim()) return; 
        const url = (msg.match(/(https?:\/\/[^\s]+)/gi) || [])[0] || "";
        const cleanText = url ? msg.replace(url, '').trim() : msg;
        const postData = { message: cleanText || "View Link", link: url, timestamp: Date.now() };

        if(editingId) { db.child(editingId).update(postData); cancelEdit(); }
        else { db.push(postData); }
        document.getElementById('msgInput').value = "";
    }

    function setStatus(id, type) {
        const postRef = db.child(id);
        postRef.once('value', snap => {
            const current = snap.val()[type] || false;
            postRef.update({ [type]: !current });
        });
    }

    function deletePost(id) { if(confirm("Delete post?")) db.child(id).remove(); }

    function editPost(id, oldMsg, oldLink) {
        document.getElementById('adminPanel').style.display = 'block';
        document.getElementById('cancelBtn').style.display = 'block';
        document.getElementById('msgInput').value = oldMsg + (oldLink ? "\n" + oldLink : "");
        document.getElementById('editingId').value = id;
        document.getElementById('submitBtn').innerText = "Update";
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function cancelEdit() {
        document.getElementById('editingId').value = "";
        document.getElementById('msgInput').value = "";
        document.getElementById('submitBtn').innerText = "Broadcast";
        document.getElementById('cancelBtn').style.display = 'none';
    }

    db.limitToLast(500).on('value', (snapshot) => {
        const feedDiv = document.getElementById('feed');
        const data = snapshot.val();
        if (!firstLoad && data) {
            const last = Object.values(data).pop();
            if (!isMuted) document.getElementById('notifSound').play().catch(() => {});
            notifyTeam(last.message);
        }
        firstLoad = false;
        feedDiv.innerHTML = "";
        if (!data) return;

        Object.keys(data).reverse().forEach(key => {
            const post = data[key];
            const div = document.createElement('div');
            div.className = `post ${post.isMistake ? 'is-mistake' : ''} ${post.isDelay ? 'is-delay' : ''}`;
            
            let badges = '';
            if (post.isMistake) badges += `<div class="badge badge-mistake">‚õîÔ∏è INCORRECT / ERROR</div>`;
            if (post.isDelay) badges += `<div class="badge badge-delay">üïí DELAYED POST</div>`;

            div.innerHTML = `
                <div class="admin-tools">
                    <span class="tool-btn" onclick="setStatus('${key}', 'isMistake')">‚õîÔ∏è</span>
                    <span class="tool-btn" onclick="setStatus('${key}', 'isDelay')">üïí</span>
                    <span class="tool-txt" style="color:var(--primary)" onclick="editPost('${key}', \`${post.message}\`, '${post.link}')">EDIT</span>
                    <span class="tool-txt" style="color:var(--error)" onclick="deletePost('${key}')">DEL</span>
                </div>
                ${badges}
                <p>${post.message}</p
